<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è DOCX ‚Äì –ø—Ä–æ–≥—Ä–µ—Å</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8fafb; }
        textarea[readonly] { background: #f4f6f8; }
        .sticky-btn { position: absolute; top: 1.4rem; right: 2.2rem; z-index: 10; }
    </style>
</head>
<body>
<div class="container py-5">
    <h3 class="mb-4 text-center">–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤</h3>
    <textarea id="logbox" class="form-control mb-3" rows="16" readonly>–û—á—ñ–∫—É–π—Ç–µ, –ø—Ä–æ—Ü–µ—Å –∑–∞–ø—É—â–µ–Ω–æ...</textarea>
    <div id="donebox" class="alert alert-success d-none">
        <a id="downloadLink" href="#" class="btn btn-success">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</a>
    </div>
    <button id="stopBtn" class="btn btn-danger flex-shrink-0">üõë –ó—É–ø–∏–Ω–∏—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é</button>
    <a href="/" class="btn btn-outline-secondary flex-shrink-0">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
</div>
<script>
let session_id = "{{ session_id }}";
let done = false;

function fetchLogs() {
    fetch("/logs/" + session_id)
      .then(response => response.text())
      .then(data => {
        document.getElementById('logbox').value = data;
        document.getElementById('logbox').scrollTop = document.getElementById('logbox').scrollHeight;
      });
}
function checkDone() {
    fetch("/result/" + session_id, {method: "HEAD"})
      .then(response => {
          if (response.status === 200 && !done) {
              done = true;
              document.getElementById("donebox").classList.remove("d-none");
              document.getElementById("downloadLink").href = "/result/" + session_id;
              // –û—Å—å —Ç—É—Ç –∑—É–ø–∏–Ω—è—î–º–æ –≤—Å—ñ —Ç–∞–π–º–µ—Ä–∏!
              clearInterval(logsTimer);
              clearInterval(doneTimer);
              // –ë–æ–Ω—É—Å: –≤–∏–º–∏–∫–∞—î–º–æ/—Ö–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É STOP
              document.getElementById('stopBtn').disabled = true;
              document.getElementById('stopBtn').classList.add("d-none");
          }
      });
}
let logsTimer = setInterval(fetchLogs, 10000);   // 2 —Å–µ–∫—É–Ω–¥–∏ - –¥–ª—è –∂–∏–≤–∏—Ö –ª–æ–≥—ñ–≤
let doneTimer = setInterval(checkDone, 10000);


document.getElementById('stopBtn').onclick = function() {
    fetch("/stop/" + session_id, {method: "POST"})
      .then(_ => {
        clearInterval(logsTimer);
        clearInterval(doneTimer);
        document.getElementById('stopBtn').disabled = true;
        document.getElementById('stopBtn').textContent = "–ó—É–ø–∏–Ω—è—î—Ç—å—Å—è...";
      });
}

</script>
</body>
</html>
