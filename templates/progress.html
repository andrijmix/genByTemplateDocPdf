<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Генерація DOCX – прогрес</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8fafb; }
        textarea[readonly] { background: #f4f6f8; }
    </style>
</head>
<body>
<div class="container py-5">
    <h3 class="mb-4 text-center">Генерація документів</h3>
    <textarea id="logbox" class="form-control mb-3" rows="16" readonly>Очікуйте, процес запущено...</textarea>
    <div id="donebox" class="alert alert-success d-none">
        <a id="downloadLink" href="#" class="btn btn-success">⬇️ Завантажити результати</a>
    </div>
    <a href="/" class="btn btn-outline-secondary">← На головну</a>
</div>
<script>
let session_id = "{{ session_id }}";
let done = false;
function fetchLogs() {
    fetch("/logs/" + session_id)
      .then(response => response.text())
      .then(data => {
        document.getElementById('logbox').value = data;
        document.getElementById('logbox').scrollTop = document.getElementById('logbox').scrollHeight;
      });
}
function checkDone() {
    fetch("/result/" + session_id, {method: "HEAD"})
      .then(response => {
          if (response.status === 200 && !done) {
              done = true;
              document.getElementById("donebox").classList.remove("d-none");
              document.getElementById("downloadLink").href = "/result/" + session_id;
          }
      });
}
setInterval(fetchLogs, 2000);
setInterval(checkDone, 2000);
</script>
</body>
</html>
